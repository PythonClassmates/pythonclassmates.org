<!DOCTYPE html>
<html lang="fr">
<head>
        <meta charset="utf-8" />
        <title>Python I/O - web</title>
        <link rel="stylesheet" href="https://www.pythonclassmates.org/theme/css/main.css" />
        <link href="https://www.pythonclassmates.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Python I/O Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://www.pythonclassmates.org/">Python I/O <strong>Articles et news par des Pythonistas passionnés</strong></a></h1>
                <nav><ul>
                    <li><a href="/category/news.html">News</a></li>
                    <li><a href="/category/articles.html">Articles</a></li>
                    <li><a href="/category/tutoriels.html">Tutoriels</a></li>
                    <li><a href="/categories.html">Catégories</a></li>
                    <li><a href="/tags.html">Tags</a></li>
                    <li><a href="https://www.pythonclassmates.org/category/article.html">Article</a></li>
                    <li><a href="https://www.pythonclassmates.org/category/articles.html">Articles</a></li>
                    <li><a href="https://www.pythonclassmates.org/category/news.html">News</a></li>
                    <li><a href="https://www.pythonclassmates.org/category/tutoriels.html">Tutoriels</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://www.pythonclassmates.org/ameliorez-votre-front-end-avec-webpack.html">Django + Webpack : le front-end niveau supérieur</a></h1>
<footer class="post-info">
        <abbr class="published" title="2019-03-28T13:00:00+01:00">
                Published: Thu 28 March 2019
        </abbr>
		<br />
        <abbr class="modified" title="2019-03-28T13:00:00+01:00">
                Updated: Thu 28 March 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://www.pythonclassmates.org/author/mikael-briolet.html">Mikael Briolet</a>
        </address>
<p>In <a href="https://www.pythonclassmates.org/category/articles.html">articles</a>.</p>
<p>tags: <a href="https://www.pythonclassmates.org/tag/web.html">web</a> <a href="https://www.pythonclassmates.org/tag/front-end.html">front-end</a> </p>
</footer><!-- /.post-info --><p><img alt="webpakc logo" src="https://i0.wp.com/blog.js-republic.com/wp-content/uploads/2018/02/logo-webpack.png?fit=491%2C497"></p>
<p>Le front-end ne se limite pas à une utilisation basique de HTML, CSS et Javascript. Il existe une infinité de bibliothèques Javascript qui nous facilite la vie, ouvre le champ des possibles.<br>
Ces bibliothèques Javascript sont aujourd'hui rendues accessibles via le gestionnaire de package <a href="https://www.npmjs.com/"><code>npm</code>, ou "Node Package Manager"</a>.<br>
Webpack vient ensuite en renfort, pour automatiser l'environnement front-end en transformant et en assemblant les dépendances JS et les différents modules en un fichier unique. Ses possibilités sont d'ailleurs bien plus grandes, et il permet aussi d'intégrer le CSS, les images, les fonts...</p>
<h1>NPM, le pip du Javascript</h1>
<p>NPM est le gestionnaire de packages Javascript le plus utilisé aujourd'hui. Au départ conçu pour gérer les modules Node.js, <a href="https://nodejs.org/en/">une intégration backend du Javascript</a>, des paquets comme Webpack ou Browserify ont permis de gérer l'environnement front-end de manière élégante.
<a href="https://stackshare.io/stackups/browserify-vs-webpack">Webpack est cependant plus populaire que browserify</a>.</p>
<h1>Mise en place du projet</h1>
<p>Dans le cadre de ce guide, nous allons créer un nouveau projet Django que nous appellerons "setupwebpack".</p>
<blockquote>
<p>Notez que si nous allons nous concentrer sur le framework Django, Webpack s'intègre tout aussi bien dans d'autres configurations, comme Flask ou Pelican.</p>
</blockquote>
<h2>Installation des dépendances</h2>
<p>Nous utiliserons Python 3.6, ainsi que le gestionnaire d'environnement Poetry.</p>
<blockquote>
<p>Note : Poetry s'utilise comme Pipenv. Aussi, si vous êtes plus à l'aise avec Pipenv (ou un autre gestionnaire d'environnement virtuel), libre à vous d'utiliser le vôtre.</p>
</blockquote>
<p>Nous aurons aussi besoin de NodeJs et son gestionnaire de paquets npm, <a href="https://nodejs.org/en/">à installer depuis cette adresse</a>.</p>
<p>Créez enfin un nouveau dossier "setupwebpack" et ouvrez votre shell à sa racine. Lancez ensuite ces commandes :</p>
<div class="highlight"><pre><span></span>poetry init <span class="c1"># génère un nouvel environnement virtuel.</span>
poetry add django <span class="c1"># installe django.</span>
poetry add -D pylint pydocstyle flake8 <span class="c1"># on installe les Linters.</span>
npm init -y <span class="c1"># génère une fichier package.json (&#39;-y&#39; pour une configuration par défaut).</span>
</pre></div>


<h1>La mise en place de Django</h1>
<p>Nous allons initialiser Django et créer une vue simple, pour tester notre environnement front-end.</p>
<p>Commencons par initialiser le projet Django :</p>
<div class="highlight"><pre><span></span>poetry shell <span class="c1"># On lance le shell dans l&#39;environnement virtuel.</span>
django-admin.py startproject project .
<span class="c1"># N&#39;oubliez pas le &#39;.&#39; pour éviter de créer un nouveau dossier.</span>
mkdir apps <span class="c1"># On créé un dossier apps pour ranger nos applications Django.</span>
</pre></div>


<blockquote>
<p>Note : Je nomme <em>project</em> le répertoire de base Django. Ce n'est pas une convention.</p>
</blockquote>
<p>Comme nous rangerons nos applications dans le dossier <code>apps</code>, nous intégrons le chemin du dossier dans le fichier <code>project/settings.py</code> :</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
<span class="n">APPS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;apps&#39;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">APPS_DIR</span><span class="p">)</span>

<span class="c1"># ...</span>
</pre></div>


<p>Ce qui nous permet d'ajouter nos applications dans <code>INSTALLED_APPS</code> sans avoir à préfixer le chemin par <code>apps/</code>.<br>
Continuons en initialisant notre première application :</p>
<div class="highlight"><pre><span></span>poetry shell <span class="c1"># Si ce n&#39;est pas déjà fait.</span>
<span class="nb">cd</span> apps
touch __init__.py
django-admin startapp home
<span class="nb">cd</span> ..
</pre></div>


<p>Ensuite :</p>
<div class="highlight"><pre><span></span><span class="c1"># settings.py</span>

<span class="c1"># ...</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c1"># my apps</span>
    <span class="s1">&#39;home&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># ...</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;home.urls&#39;</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>


<p>Occupons nous maintenant de l'application <code>home</code> :</p>
<div class="highlight"><pre><span></span>touch apps/home/urls.py
mkdir apps/home/templates
touch apps/home/templates/base.html
touch apps/home/templates/home.html
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># apps/home/urls.py</span>

<span class="sd">&quot;&quot;&quot;Home urls.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">HomePageView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">HomePageView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># apps/home/views.py</span>

<span class="sd">&quot;&quot;&quot;Home views.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">TemplateView</span>


<span class="k">class</span> <span class="nc">HomePageView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the Home page.&quot;&quot;&quot;</span>

    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;home.html&quot;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the context.&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Home sweet home&quot;</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">&lt;!-- apps/home/templates/base.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;fr&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>SetupWebpack | {{ title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;banner&quot;</span><span class="p">&gt;</span>{% block banner %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>{% block content %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">&lt;!-- apps/home/templates/home.html --&gt;</span>

{% extends &quot;base.html&quot; %} {% block banner %}

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello Webpack !<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

{% endblock %} {% block content %} {% lorem 5 %} {% endblock %}
</pre></div>


<p>Et lançons les commandes d'initalisation du serveur :</p>
<div class="highlight"><pre><span></span>python manage.py migrate
python manage.py runserver
</pre></div>


<p>Le résultat dans la console :</p>
<div class="highlight"><pre><span></span>Performing system checks...

System check identified no issues <span class="o">(</span><span class="m">0</span> silenced<span class="o">)</span>.
March <span class="m">28</span>, <span class="m">2019</span> - <span class="m">16</span>:40:58
Django version <span class="m">2</span>.1.7, using settings <span class="s1">&#39;project.settings&#39;</span>
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
</pre></div>


<p>Parfait, le serveur tourne ! :)<br>
Allons voir sur <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> :
<a href="https://www.pythonclassmates.org/extra/images/django_webpack/base.png" target="_blank">
<img src="https://www.pythonclassmates.org/extra/images/django_webpack/base.png" style="height: 100%; width: 100%; display: block;"></a></p>
<p>Un beau "hello Webpack", suivi de <a href="https://docs.djangoproject.com/fr/2.1/ref/templates/builtins/#lorem">plusieurs paragraphes en latin</a> s'affichent. Attention ceci-dit, ce tuto ne portera pas sur ces deux langages. Je vous laisse vous documenter pour en apprendre plus sur eux. ;)</p>
<h1>La mise en place de Webpack</h1>
<p>On passe maintenant à Webpack ! Dans le cadre de ce guide, nous allons utiliser le langage <a href="https://www.typescriptlang.org/">Typescript</a> et <a href="https://sass-lang.com/">SCSS</a>. Nous allons aussi installer <a href="https://www.chartjs.org/docs/latest/">chart.js</a>, que j'ai choisi de tester pour l'occasion.</p>
<blockquote>
<p>Note : l'intérêt de Webpack est, entre autres, de profiter des langages dits de "surcouche" comme le SCSS ou le typescript. En effet, Webpack se chargera de transpiler ces surcouches en CSS et JS avant de les intégrer dans un seul fichier Js.</p>
<p>Note sur l'utilisation de Typescript : On aurait aussi pu utiliser Javascript ES6.</p>
</blockquote>
<p>On commence donc par l'installation de Webpack :</p>
<div class="highlight"><pre><span></span>npm install webpack webpack-cli --save-dev
<span class="c1"># Le module &quot;webpack&quot; gère les fonctionnalités de Webpack,</span>
<span class="c1"># et le module &quot;webpack-cli&quot; gère l&#39;affichage dans le shell.</span>
touch webpack.config.js
</pre></div>


<p>Webpack se configure à partir d'un fichier appelé <code>webpack.config.js</code>. Nous allons donc créer la structure de base de ce fichier :</p>
<div class="highlight"><pre><span></span><span class="c1">// webpack.congig.js</span>

<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">entry</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;assets/dev/index.js&quot;</span><span class="p">),</span>
  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;bundle.js&quot;</span><span class="p">,</span>
    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;assets/dist&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>Dans ce début de configuration :</p>
<ul>
<li>on importe le module <code>path</code> pour gérer les chemins de fichiers.</li>
<li>on exporte un object contenant plusieurs attributs dont :</li>
<li><code>entry</code> : le chemin du fichier Javascript qu'on fait lire à Webpack.</li>
<li><code>ouptut</code> : un objet qui renvoie le nom du fichier de sortie et son emplacement dans le projet.</li>
</ul>
<p>On a ici la base de la structure de Webpack.<br>
<strong>En fait Webpack, c'est juste un script qui prend un fichier en entrée et qui en génère un autre en sortie.</strong></p>
<p>Appelons le module "webpack" :</p>
<div class="highlight"><pre><span></span>npx webpack
<span class="c1"># npx est la commande npm pour appeler un module dans le shell.</span>
</pre></div>


<p>On obtient en sortie :</p>
<div class="highlight"><pre><span></span>Insufficient number of arguments or no entry found.
Alternatively, run <span class="s1">&#39;webpack(-cli) --help&#39;</span> <span class="k">for</span> usage info.

Hash: 8cba692fdb1abc7fcae0
Version: webpack <span class="m">4</span>.29.6
Time: 108ms
Built at: <span class="m">2019</span>-03-29 <span class="m">11</span>:31:23

WARNING in configuration
The <span class="s1">&#39;mode&#39;</span> option has not been set, webpack will fallback to <span class="s1">&#39;production&#39;</span> <span class="k">for</span> this value. Set <span class="s1">&#39;mode&#39;</span> option to <span class="s1">&#39;development&#39;</span> or <span class="s1">&#39;production&#39;</span> to <span class="nb">enable</span> defaults <span class="k">for</span> each environment.
You can also <span class="nb">set</span> it to <span class="s1">&#39;none&#39;</span> to disable any default behavior. Learn more: https://webpack.js.org/concepts/mode/

ERROR in Entry module not found: Error: Can<span class="s1">&#39;t resolve &#39;</span>./assets/dev/index.js<span class="s1">&#39; in &#39;</span>your<span class="se">\p</span>ath<span class="se">\s</span>etupwebpack<span class="err">&#39;</span>
</pre></div>


<p>Webpack s'est bien lancé. Un message de vigilance nous informe qu'on n'a pas spécifié de "mode" pour le lancement, et Webpack utilise donc le mode "production". Les modes permettent de créer des comportement différents entre le developpement et la production. Par défaut, le code en mode production est "minifié", pour gagner de la mémoire.<br>
Enfin, un message d'erreur nous informe que le fichier d'entrée spécifié n'a pas été trouvé. Et en effet, on a spécifié dans la configuration un fichier qu'on n'a pas encore créé, réglons cela tout de suite :</p>
<div class="highlight"><pre><span></span>mkdir assets
mkdir assets/dev
touch assets/dev/index.js
mkdir assets/dist
</pre></div>


<p>On a crée un dossier <code>assets</code> à la racine du projet qui va contenir les fichiers d'entrée et de sortie pour Webpack, rangés dans les dossiers <code>dev</code> (pour développement) et <code>dist</code> (pour distribution).</p>
<p>Maintenant quand on lance :</p>
<div class="highlight"><pre><span></span>npx webpack
</pre></div>


<p>On observe que la compilation se passe sans souci, et un fichier <code>bundle.js</code> est visible dans le dossier <code>assets/dist</code>. Quand on ouvre ce fichier, on y voit du code Javascript minifié :</p>
<div class="highlight"><pre><span></span><span class="o">!</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">function</span> <span class="nx">r</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">n</span><span class="p">])</span> <span class="k">return</span> <span class="nx">t</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">exports</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">i</span><span class="o">:</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">l</span><span class="o">:</span> <span class="o">!</span><span class="mi">1</span><span class="p">,</span> <span class="nx">exports</span><span class="o">:</span> <span class="p">{}</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">r</span><span class="p">),</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="o">!</span><span class="mi">0</span><span class="p">),</span> <span class="nx">o</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">e</span><span class="p">),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">t</span><span class="p">),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="o">||</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="p">{</span> <span class="nx">enumerable</span><span class="o">:</span> <span class="o">!</span><span class="mi">0</span><span class="p">,</span> <span class="nx">get</span><span class="o">:</span> <span class="nx">n</span> <span class="p">});</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="s2">&quot;undefined&quot;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">Symbol</span> <span class="o">&amp;&amp;</span>
        <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span> <span class="o">&amp;&amp;</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&quot;Module&quot;</span> <span class="p">}),</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="s2">&quot;__esModule&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="o">!</span><span class="mi">0</span> <span class="p">});</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="nx">t</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">r</span><span class="p">(</span><span class="nx">e</span><span class="p">)),</span> <span class="mi">8</span> <span class="o">&amp;</span> <span class="nx">t</span><span class="p">))</span> <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&amp;</span> <span class="nx">t</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;object&quot;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">__esModule</span><span class="p">)</span> <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">n</span><span class="p">),</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">enumerable</span><span class="o">:</span> <span class="o">!</span><span class="mi">0</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">e</span> <span class="p">}),</span>
        <span class="mi">2</span> <span class="o">&amp;</span> <span class="nx">t</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;string&quot;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">e</span><span class="p">)</span>
      <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">e</span><span class="p">)</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span>
            <span class="nx">n</span><span class="p">,</span>
            <span class="nx">o</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="nx">t</span><span class="p">];</span>
            <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span>
          <span class="p">);</span>
      <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span>
        <span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">__esModule</span>
          <span class="o">?</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="k">default</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
            <span class="p">};</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="nx">t</span><span class="p">),</span> <span class="nx">t</span><span class="p">;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">);</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
    <span class="nx">r</span><span class="p">((</span><span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">));</span>
<span class="p">})([</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{}]);</span>
</pre></div>


<p>C'est le code généré de base par Webpack. Attachons maintenant ce fichier <code>bundle.js</code> à notre template de base :</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!-- apps/home/templates/base.html --&gt;</span>

...

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;banner&quot;</span><span class="p">&gt;</span>{% block banner %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>{% block content %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  {% load static %}
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static &#39;bundle.js&#39; %}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

...
</pre></div>


<p>Et d'intégrer la récupération du fichier <code>bundle.js</code> avec la commande <code>collecstatic</code> de Django</p>
<div class="highlight"><pre><span></span><span class="c1"># project/settings.py</span>

<span class="c1"># ...</span>

<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;assets&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">),]</span>
</pre></div>


<h2>L'automatisation des tâches</h2>
<p>Quand on utilise Webpack, on a tendance à automatiser les commandes de lancement en passant par les scripts npm. Modifions notre fichier<code>package.json</code> :</p>
<div class="highlight"><pre><span></span><span class="err">//</span> <span class="err">package.json</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;setupwebpack&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;dev&quot;</span><span class="p">:</span> <span class="s2">&quot;webpack --mode=development&quot;</span><span class="p">,</span>
    <span class="nt">&quot;build&quot;</span><span class="p">:</span> <span class="s2">&quot;webpack --mode=production&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;keywords&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;webpack&quot;</span><span class="p">:</span> <span class="s2">&quot;^4.29.6&quot;</span><span class="p">,</span>
    <span class="nt">&quot;webpack-cli&quot;</span><span class="p">:</span> <span class="s2">&quot;^3.3.0&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Ainsi quand on voudra lancer les commandes Webpack, il nous suffira d'écrire :</p>
<ul>
<li><code>npm run dev</code> pour une génération en mode développement.</li>
<li><code>npm run build</code> pour une génération en mode production.</li>
</ul>
<blockquote>
<p>Astuce : la commande <code>npm run dev</code> va générer du code pour le développement, qui ne sera pas minifié. Aussi, vous pourrez visionner vos modules JS séparemment depuis le navigateur (onglet "source" dans l'outil de développement de Chrome) avec l'apparition d'un dossier "webpack", ce qui reste très pratique pour débugguer :
<a href="https://www.pythonclassmates.org/extra/images/django_webpack/webpack_debug.png" target="_blank"> <img src="https://www.pythonclassmates.org/extra/images/django_webpack/webpack_debug.png" style="height: 100%; width: 100%; display: block;"></a></p>
</blockquote>
<p>Bon, vous allez me dire que taper à chaque fois <code>npm run dev</code>, pour visualiser les changements apportés, c'est lourd... Et pour ça, j'ai aussi une solution, la commande <code>watch</code> de Webpack :</p>
<div class="highlight"><pre><span></span><span class="err">//</span> <span class="err">package.json</span>

<span class="p">{</span>
  <span class="err">//</span> <span class="err">...</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;dev&quot;</span><span class="p">:</span> <span class="s2">&quot;webpack --mode=development&quot;</span><span class="p">,</span>
    <span class="nt">&quot;build&quot;</span><span class="p">:</span> <span class="s2">&quot;webpack --mode=production&quot;</span><span class="p">,</span>
    <span class="nt">&quot;watch&quot;</span><span class="p">:</span> <span class="s2">&quot;webpack --watch --mode=development&quot;</span>
  <span class="p">}</span>
  <span class="err">//</span> <span class="err">...</span>
<span class="p">}</span>
</pre></div>


<p>En tapant <code>npm run watch</code>, Webpack sera constament en alerte sur les changements apportés au fichier statiques utilisés, et recompilera automatiquement à chaque fois qu'un nouveau changement sera enregistré.</p>
<p>Faisons un rapide test en lancant <code>npm run watch</code> :</p>
<div class="highlight"><pre><span></span><span class="c1">// assets/dev/index.js</span>

<span class="kd">let</span> <span class="nx">test</span> <span class="o">=</span> <span class="s2">&quot;Un rapide test.&quot;</span><span class="p">;</span>
</pre></div>


<p>On voit dans le shell que Webpack compile automatiquement lors de la sauvegarde :</p>
<div class="highlight"><pre><span></span>Hash: 56c73a6c491e47da8193
Version: webpack <span class="m">4</span>.29.6
Time: 17ms
Built at: <span class="m">2019</span>-04-01 <span class="m">10</span>:24:26
    Asset      Size  Chunks             Chunk Names
bundle.js  <span class="m">3</span>.85 KiB    main  <span class="o">[</span>emitted<span class="o">]</span>  main
Entrypoint <span class="nv">main</span> <span class="o">=</span> bundle.js
<span class="o">[</span>./assets/dev/index.js<span class="o">]</span> <span class="m">37</span> bytes <span class="o">{</span>main<span class="o">}</span> <span class="o">[</span>built<span class="o">]</span>
</pre></div>


<h2>Transpiler le SCSS en CSS</h2>
<p>Nous allons maintenant utiliser une fonctionnalité indispensable de Webpack : sa faculté à transpiler les langages lors de son éxecution. Pour compiler le SCSS en CSS, nous allons faire appel à plusieurs <a href="https://webpack.js.org/concepts/loaders/">loaders</a> pour Webpack :</p>
<ol>
<li><a href="https://github.com/webpack-contrib/sass-loader">sass-loader</a> pour la conversion du SCSS en CSS</li>
<li><a href="https://github.com/webpack-contrib/css-loader">css-loader</a> pour gérer l'importation des fichiers CSS depuis Javascript</li>
<li><a href="https://github.com/webpack-contrib/mini-css-extract-plugin">mini-css-extract-plugin</a> pour recréer les fichiers CSS.</li>
</ol>
<p>Installons les dès maintenant :</p>
<div class="highlight"><pre><span></span>npm i -D sass-loader node-sass css-loader mini-css-extract-plugin
<span class="c1"># &#39;i&#39; pour install, &#39;-D&#39; pour &#39;--save-dev&#39;. On peut installer plusieurs modules en une commande.</span>
</pre></div>


<p>Maintenant modifions notre fichier <code>webpack.config.js</code> :</p>
<div class="highlight"><pre><span></span><span class="c1">// webpack.config.js</span>

<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mini-css-extract-plugin&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">entry</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;assets/dev/index.js&quot;</span><span class="p">),</span>
    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;bundle.js&quot;</span><span class="p">,</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;assets/dist&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
            <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;[name].css&#39;</span><span class="p">,</span>
            <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s1">&#39;[id].css&#39;</span><span class="p">,</span>
        <span class="p">})</span>
    <span class="p">],</span>
    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">rules</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.scss$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
                <span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span> <span class="c1">// 3. Recrée les fichiers css à partir de leurs équivalents en Javascript.</span>
                <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span> <span class="c1">// 2. Converti les fichiers CSS en équivalents Javascript</span>
                <span class="s2">&quot;sass-loader&quot;</span> <span class="c1">// 1. Transpile le SCSS en CSS</span>
            <span class="p">],</span>
            <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>On observe plusieurs ajouts :</p>
<ol>
<li>On importe le module <code>mini-css-extract-plugin</code></li>
<li>On ajoute un tableau <code>plugins</code> dans notre objet principal, qui contient la configuration (très basique) de notre plugin <code>mini-css-extract-plugin</code></li>
<li>On ajoute un objet <code>module</code> dans notre objet principal, qui s'occupe des transformations des codes sources lors d'une importation depuis notre fichier <code>index.js</code>.</li>
</ol>
<p>Dans notre objet <code>module</code>, on spécifie un tableau <code>rules</code> qui va contenir des "règles" pour appliquer nos loaders. Chaque règle est définie dans un nouvel objet (nous avons donc créé un objet spécifique pour les règles de nos fichier .scss), et possède trois variables :</p>
<ul>
<li><code>test</code> qui est une chaîne de type <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Guide/Expressions_r%C3%A9guli%C3%A8res">Regex</a> qui va définir quels sont les fichiers pris en compte par cette règle</li>
<li><code>use</code> qui est un tableau qui définit les loaders à utiliser (Ils se résolvent du dernier au premier dans le tableau)</li>
<li><code>exclude</code>, qui est aussi une chaîne Regex, qui définit les fichiers/dossiers à ne pas tester (<code>node_modules</code> dans notre exemple).</li>
</ul>
<p>Vous connaissez maintenant la structure classique d'un fichier <code>webpack.config.js</code>. A chaque fois que nous voudrons prendre en charge un nouveau type de fichier, nous ajouterons une nouvelle règle, et de nouveaux loaders. Le tableau <code>plugins</code> permet de configurer nos loaders, ou d'ajouter un nouveau comportement à Webpack via d'autres types de plugins.<br>
Les possibités sont immenses, mais la base restera toujours la même. ;)</p>
<p>C'est maintenant l'heure de tester notre configuration :</p>
<div class="highlight"><pre><span></span><span class="c1"># Dans votre Shell :</span>
touch assets/dev/main.scss
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// assets/dev/main.scss</span>

<span class="nv">$banner</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">77</span><span class="o">,</span> <span class="mi">162</span><span class="o">,</span> <span class="mi">201</span><span class="p">);</span>
<span class="nv">$gray</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">75</span><span class="o">,</span> <span class="mi">75</span><span class="o">,</span> <span class="mi">75</span><span class="p">);</span>
<span class="nv">$green</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">52</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">154</span><span class="p">);</span>

<span class="nv">$content_padding</span><span class="o">:</span> <span class="mi">5</span><span class="kt">%</span> <span class="mi">20</span><span class="kt">%</span> <span class="mi">0</span><span class="kt">%</span> <span class="mi">20</span><span class="kt">%</span><span class="p">;</span>

<span class="c1">// Minimal reset style :</span>
<span class="o">*</span> <span class="p">{</span>
  <span class="nt">padding</span><span class="nd">:</span> <span class="nt">0</span><span class="o">;</span>
  <span class="nt">margin</span><span class="nd">:</span> <span class="nt">0</span><span class="o">;</span>
<span class="p">}</span>

<span class="c1">// Some tests :</span>
<span class="nc">.banner</span> <span class="p">{</span>
  <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">banner</span><span class="o">;</span>
  <span class="nt">padding</span><span class="nd">:</span> <span class="nt">3</span><span class="err">%</span><span class="o">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="nt">color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">gray</span><span class="o">;</span>
  <span class="nt">text-align</span><span class="nd">:</span> <span class="nt">center</span><span class="o">;</span>

  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="nt">color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">green</span><span class="o">;</span>
    <span class="nt">cursor</span><span class="nd">:</span> <span class="nt">pointer</span><span class="o">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nc">.content</span> <span class="p">{</span>
  <span class="nt">font-size</span><span class="nd">:</span> <span class="nt">1</span><span class="nc">.2em</span><span class="o">;</span>
  <span class="nt">padding</span><span class="nd">:</span> <span class="err">$</span><span class="nt">content_padding</span><span class="o">;</span>
  <span class="nt">text-align</span><span class="nd">:</span> <span class="nt">justify</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// assets/dev/index.js</span>

<span class="kr">import</span> <span class="s2">&quot;./main.scss&quot;</span><span class="p">;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">&lt;!-- apps/home/templates/base.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;fr&quot;</span><span class="p">&gt;</span>
  {% load static %}

  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>SetupWebpack | {{ title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% static &#39;main.css&#39; %}&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;banner&quot;</span><span class="p">&gt;</span>{% block banner %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>{% block content %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static &#39;bundle.js&#39; %}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>Si vous avez laissé la commande <code>npm run watch</code> en éxecution depuis tout à l'heure, alors les changements sont déjà sauvegardés. Sinon, c'est l'heure de la relancer. Si tout se passe bien, vous pouvez déjà constaté l'équivalent <code>.css</code> de notre fichier <code>main.scss</code> dans le répertoire <code>assets/dist</code> !<br>
Executez enfin <code>poetry run python manage.py runserver</code> pour visionner le port <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> :<br>
<a href="https://www.pythonclassmates.org/extra/images/django_webpack/avec_css.png" target="_blank">
<img src="https://www.pythonclassmates.org/extra/images/django_webpack/avec_css.png" style="height: 100%; width: 100%; display: block;"></a></p>
<p>Tout fonctionne bien. :)</p>
<h2>Transpiler le Typescript en Javascript</h2>
<p>La gestion du SCSS étant bien implémentée, nous allons maintenant passer au Typescript !<br>
Nous aurons besoin du module <code>typescript</code>, du loader <a href="https://github.com/TypeStrong/ts-loader">ts-loader</a> et du linter <code>tslint</code> :</p>
<div class="highlight"><pre><span></span>npm i -D typescript ts-loader tslint
tsc --init  <span class="c1"># Génère le fichier de configuration de Typescript.</span>
</pre></div>


<p>Spécifiez <code>"module": "es6"</code> dans le fichier <code>tsconfig.json</code>.</p>
<p>On passe maintenant une nouvelle règle à notre fichier <code>webpack.config.js</code> :</p>
<div class="highlight"><pre><span></span>        <span class="p">...</span>

        <span class="nx">entry</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;assets/dev/index.ts&quot;</span><span class="p">),</span>

        <span class="p">...</span>

        <span class="nx">rules</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.scss$/</span><span class="p">,</span>
                <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
                    <span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                    <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;sass-loader&quot;</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.ts$/</span><span class="p">,</span>
                <span class="nx">use</span><span class="o">:</span> <span class="s1">&#39;ts-loader&#39;</span><span class="p">,</span>
                <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;.ts&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="p">...</span>
</pre></div>


<p>Nous modifions aussi l'extension de notre fichier d'entrée en <code>index.ts</code>, qui est l'extension de Typescript, et nous ajoutons un nouvel objet <code>resolve</code>, qui va s'occuper de résoudre les extensions avant l'import (ce qui évite des bugs d'importation avec Typescript).</p>
<p>Assurez-vous de bien renommer <code>index.js</code> en <code>index.ts</code>. Ajoutons ensuite une fonction en typescript. Cette fonction sera propre à l'application <code>home</code>, nous l'ajouterons donc dans le dossier <code>assets</code> de cette application.</p>
<div class="highlight"><pre><span></span>mkdir apps/home/assets
mkdir apps/home/assets/ts
mkdir apps/home/assets/scss
touch apps/home/assets/ts/main.ts
touch apps/home/assets/ts/_main.scss
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// apps/home/assets/ts/main.ts</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">homeSetup</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">content</span><span class="o">:</span> <span class="nx">Element</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span>
    <span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">flashyContent</span><span class="p">(</span><span class="nx">content</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">flashyContent</span><span class="p">(</span><span class="nx">content</span><span class="o">:</span> <span class="nx">Element</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">className</span><span class="o">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="s2">&quot;flashy&quot;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">content</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">className</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">className</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">className</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// assets/dev/index.ts</span>

<span class="kr">import</span> <span class="s2">&quot;./main.scss&quot;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">homeSetup</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../../apps/home/assets/ts/main&quot;</span><span class="p">;</span>

<span class="c1">// Notez l&#39;appel des différents modules en fonction de l&#39;adresse de la page.</span>
<span class="c1">// Ce n&#39;est pas une convention, mais plutot une astuce personnelle.</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span>
  <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Main function.</span>
    <span class="kr">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;/&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">homeSetup</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="kc">false</span>
<span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// assets/dev/main.scss</span>

<span class="k">@import</span> <span class="s1">&#39;../../apps/home/assets/scss/main&#39;</span><span class="p">;</span>

<span class="nc">...</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// apps/home/assets/scss/_main.scss</span>

<span class="nv">$flashy_font</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">234</span><span class="p">);</span>
<span class="nv">$flashy_background</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">60</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nc">.content</span> <span class="p">{</span>
  <span class="nt">cursor</span><span class="nd">:</span> <span class="nt">pointer</span><span class="o">;</span>
<span class="p">}</span>

<span class="nc">.flashy</span> <span class="p">{</span>
  <span class="nt">color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">flashy_font</span><span class="o">;</span>
  <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">flashy_background</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>


<p>Notre fonction indispensable est prête à être testée. Lancez <code>npm run watch</code> ainsi que votre serveur Django pour juger du (magnifique) résultat :
<a href="https://www.pythonclassmates.org/extra/images/django_webpack/avec_typescript.png" target="_blank">
<img src="https://www.pythonclassmates.org/extra/images/django_webpack/avec_typescript.png" style="height: 100%; width: 100%; display: block;"></a></p>
<p>Quand nous cliquons sur le texte, nous avons bien ce changement de classe introduit par notre code Typescript. :)</p>
<h2>Ajoutons la bibliothèque Chart.js</h2>
<p>Webpack possède un bel avantage, c'est qu'il incorpore les bibliothèques importées dans le fichier final. Du coup, tout est centralisé et condensé.</p>
<p>Pour commencer, installons la bibliothèque <a href="https://www.chartjs.org/docs/latest/">chart.js</a> :</p>
<div class="highlight"><pre><span></span>npm i -D chart.js
</pre></div>


<p>Et ajoutons ce petit joujou à notre projet (on va enfin avoir quelque chose de vraiment joli !) :</p>
<div class="highlight"><pre><span></span><span class="c1">// apps/home/assets/ts/main.ts</span>

<span class="kr">import</span> <span class="nx">Chart</span> <span class="nx">from</span> <span class="s2">&quot;chart.js&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">homeSetup</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="nx">initGraph</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="kd">function</span> <span class="nx">initGraph</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;myChart&quot;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">datasets</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">backgroundColor</span><span class="o">:</span> <span class="p">[</span>
          <span class="s2">&quot;rgb(255, 99, 132)&quot;</span><span class="p">,</span>
          <span class="s2">&quot;rgb(54, 162, 235)&quot;</span><span class="p">,</span>
          <span class="s2">&quot;rgb(255, 206, 86)&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="nx">borderColor</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;rgb(255, 255, 255)&quot;</span><span class="p">],</span>
        <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
    <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Rouge&quot;</span><span class="p">,</span> <span class="s2">&quot;Bleu&quot;</span><span class="p">,</span> <span class="s2">&quot;Jaune&quot;</span><span class="p">],</span>
  <span class="p">};</span>

  <span class="kr">const</span> <span class="nx">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chart</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">,</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;polarArea&quot;</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">&lt;!-- apps/home/templates/home.html --&gt;</span>

{% extends &quot;base.html&quot; %} {% block banner %}

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello Webpack !<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

{% endblock %} {% block content %} {% lorem 5 %}

<span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;myChart&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;400&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>


<p>Et voila le travail ! Lorsque Webpack génère le fichier de sortie, on peut voir que la bibliothèque chart.js a bien été incorporée :
<a href="https://www.pythonclassmates.org/extra/images/django_webpack/lib_code.png" target="_blank">
<img src="https://www.pythonclassmates.org/extra/images/django_webpack/lib_code.png" style="height: 100%; width: 100%; display: block;"></a></p>
<p>Je passe les centaines de lignes restantes. :D<br>
Quand à notre site, un beau graph est maintenant visible :
<a href="https://www.pythonclassmates.org/extra/images/django_webpack/avec_chartjs.png" target="_blank">
<img src="https://www.pythonclassmates.org/extra/images/django_webpack/avec_chartjs.png" style="height: 100%; width: 100%; display: block;"></a></p>
<p>Nous arrivons à la fin de ce tuto ! J'espère qu'il vous aura été utile, et si vous avez une question ou un problème, n'hésitez pas à me contacter sur le Discord ! Pareil, si vous voyez une coquille ou une erreur, on n'est jamais à l'abri d'un oubli. :)</p>
<p>A bientôt sur le site !</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.pythonclassmates.org/installer-pelican.html" rel="bookmark"
                           title="Permalink to Installer Pelican">Installer Pelican</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-01-09T15:29:00+01:00">
                Published: Wed 09 January 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://www.pythonclassmates.org/author/freezed.html">Freezed</a>
        </address>
<p>In <a href="https://www.pythonclassmates.org/category/tutoriels.html">Tutoriels</a>.</p>
<p>tags: <a href="https://www.pythonclassmates.org/tag/web.html">web</a> <a href="https://www.pythonclassmates.org/tag/python.html">python</a> <a href="https://www.pythonclassmates.org/tag/pelican.html">pelican</a> </p>
</footer><!-- /.post-info -->                <p>Installation rapide de <em>Pelican</em></p>
                <a class="readmore" href="https://www.pythonclassmates.org/installer-pelican.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://www.pythonclassmates.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>